'use strict';

var DEFAULT_ALLOW_METHODS = ['POST', 'GET', 'PUT', 'PATCH', 'DELETE', 'OPTIONS'];

var DEFAULT_ALLOW_HEADERS = ['X-Requested-With', 'Access-Control-Allow-Origin', 'X-HTTP-Method-Override', 'Content-Type', 'Authorization', 'Accept'];

var DEFAULT_MAX_AGE_SECONDS = 60 * 60 * 24; // 24 hours

var cors = function cors() {
  var options = arguments.length > 0 && arguments[0] !== undefined ? arguments[0] : {};
  return function (handler) {
    return function (req, res) {
      for (var _len = arguments.length, restArgs = Array(_len > 2 ? _len - 2 : 0), _key = 2; _key < _len; _key++) {
        restArgs[_key - 2] = arguments[_key];
      }

      var _options$origin = options.origin,
          origin = _options$origin === undefined ? '*' : _options$origin,
          _options$maxAge = options.maxAge,
          maxAge = _options$maxAge === undefined ? DEFAULT_MAX_AGE_SECONDS : _options$maxAge,
          _options$allowMethods = options.allowMethods,
          allowMethods = _options$allowMethods === undefined ? DEFAULT_ALLOW_METHODS : _options$allowMethods,
          _options$allowHeaders = options.allowHeaders,
          allowHeaders = _options$allowHeaders === undefined ? DEFAULT_ALLOW_HEADERS : _options$allowHeaders,
          _options$allowCredent = options.allowCredentials,
          allowCredentials = _options$allowCredent === undefined ? true : _options$allowCredent,
          _options$exposeHeader = options.exposeHeaders,
          exposeHeaders = _options$exposeHeader === undefined ? [] : _options$exposeHeader;


      res.setHeader('Access-Control-Allow-Origin', origin);
      if (allowCredentials) {
        res.setHeader('Access-Control-Allow-Credentials', 'true');
      }
      if (exposeHeaders.length) {
        res.setHeader('Access-Control-Expose-Headers', exposeHeaders.join(','));
      }

      var preFlight = req.method === 'OPTIONS';
      if (preFlight) {
        res.setHeader('Access-Control-Allow-Methods', allowMethods.join(','));
        res.setHeader('Access-Control-Allow-Headers', allowHeaders.join(','));
        res.setHeader('Access-Control-Max-Age', String(maxAge));
      }

      return handler.apply(undefined, [req, res].concat(restArgs));
    };
  };
};

module.exports = cors;